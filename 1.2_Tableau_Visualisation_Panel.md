## 1.2  Tableau Visualisation & Panel

### 1)Intro

### 2)Download, Install, Activate

### 3)Link
Link to csv files via 'Link to text file'
- Note that in Tableau Public, Data Source and sheets cannot be saved. Only available in Public Desktop

快速过一下列名(49:30)
### 4)The Mechanism of Visualisation
将数据映射为视觉元素（读图）
- “度量” measure, numerical, discrete/continuous and usually computable
- “维度”dimension, usually categorial, discrete and non-computable (with exceptions)

图表类型(详见可视化辞典）
- 位置（e.g. 横轴与纵轴分别代表一个维度，观察图形所在位置）
  - 方向（折线图）
- 长度 （柱状图，条形图）
  - 面积与体积
  - 角度（饼图）  
- 形状（国旗标注国家）
  - 颜色和深浅（热力图）

Tableau可视化原理
- 从精确、强烈对比度到不精确、弱对比度： 位置 长度 角度 方向 面积 体积 饱和度 色相
- 几乎所有数据都可以被四种图概括：散点图，柱状图（条形图）、饼图、折线图
- 无轴图：树地图 tree map，饼图，气泡图，词云
- 用Tableau制作表格：用离散的维度标签即可
  - 将度量（连续的，默认进行聚合运算，如求和等；被Tableau标记为绿色）也变成标签：将它变成离散即可（蓝色）
  - 但是表格的横轴=维度名称，纵轴=一个个维度（标签）

### 5)Basic Charts
- 对比大小
  - 柱状图: 【列】门店名称（shop）【行】GMV总合（shop）
  - 条形图: 转置柱状图
  - 创建分级结构: 右键任意一个维度，如品牌（shop）-Hierarchy-Create a hierarchy，“品牌-门店-平台”，像图层一样依次拖拽维度到品牌下面；而后可以在拖入行或列后分别展开，实现数据钻取
    e.g. 【行】门店名称（shop）-门店-平台  【列】GMV总合（shop）；或可把中间的分级结构移除：【行】门店名称（shop）- 平台 【列】GMV总合（shop）
  - 添加筛选器：如门店名称；右键-显示筛选器（可以设置单选、多选、下拉等）；如度量：GMV 进行筛选，显示筛选器（为一个可以拖拽的数据区域）；类似地，日期（线性序列）进行筛选
  - 热力图（1：28：16）：【行】品牌名称，门店名称【列】度量名称Measure Names【度量值Measure Values】总和GMV，商家实收，商户补贴，平台补贴【标记】（标签）度量值（颜色）《方形》 总和GMV【筛选器】度量名称 （可以右键-显示筛选器-在右侧进行筛选）
    - 注意：完成【行】【列】后，直接拖拽GMV、商家实收等度量到空白的表格列处，来新建Measure Values的列；此时应当显示这些度量的列，并且自动增加Measure Values Shelf显示列的数据来源，同时筛选器中应当与这些列相应联动；如果不是这样，那么手动新建：将Measure Values拖入【标记】（标签），此时应当自动出现Measure Values Shelf，同时手动确保筛选器与表格中的列相对应。第三种方法利用Show Me自动绘图：Ctrl+选择相应的维度与度量，点击Show Me-表格，即自动绘制表格【列】度量名称 （筛选到所选的维度上）【行】所选度量。
    - 重点是注意到【列】度量名称 与 【标记】（标签）度量值（联动度量值Shelf）是相辅相成的，如果在操作时Tableau自动移除了其中任一或改变了其中任何设置，记得手动改回去，例如：把度量值Shelf中移除到只剩一个量时，【列】度量名称和【标记】度量值以及度量值Shelf会被自动移除，需要手动把它们放回去
    - 度量名称及度量值的其他用法：Dual Axis最多同时在一张图中显示两个量；使用度量两与度量名称，并在【标记】中用颜色对度量名称进行区分，可以同时在一张图中显示任意多个量
  - 气泡图：【标记】（大小）总和GMV《圆》，（标签）门店名称
  - 词云：【标记】（大小）总和GMV《文本》，（标签）门店名称，（颜色）门店名称
- 趋势变化
  - 折线图(1:34:33)：【列】天（日期）【行】总和GMV
    - 基于连续时间序列的折线图预测接下来的数据走向：日期可以是连续的年、月、日，也可以是离散的（即不同年份的一月都会计入‘一月’的数据），但只有前者可以进行预测：左侧 分析-拖拽‘预测’到作图区域；也可以 分析-拖拽趋势线到作图区域（线性，多项式等类型）
  - 面积图：在上述折线图上添加【标记】（颜色）平台《区域》来使不同平台的对比更清晰
- 占比构成
  - 饼图：【标记】（大小）总和GMV《饼图》，（标签）门店名称，（颜色）门店名称；
    - 添加绝对数值标签：Ctrl + 拖拽总和GMV 到标签
    - 添加百分比标签：对上面的 （标签）总和GMV 右键-快速表计算-合计百分比；或者右键-设置格式-在左侧进行设置标签格式 （注意快速表计算-百分比差异 用于同比环比计算，需要进一步编辑表计算）
  - 快速表计算（见上）
  - 树地图：【标记】（大小）总和GMV《方形》，（标签）门店名称 （另外可有可无的：（颜色）门店名称）(与气泡图除了形状为方形以外都相同）
  - 堆积（柱状、条形）图(1:31:10):【列】门店名称【行】总和GMV 【标记】（颜色）平台，（标签）总和GMV
    - 绝对值改为绝对百分比：右键【标签】总和GMV-快速表计算-合计百分比，再 编辑表计算-表（向下） 使每一条都显示以自己为整体的百分比，而不是横穿整张图表
    - 相对百分比：【行】总和GMV-快速表计算-合计百分比，编辑表计算-表（向下），使每条都呈现100%而无视每一条绝对值的大小，与上述绝对百分比结合来看（把第二个总和GMV按住Ctrl拖入【行】，得到不同表计算的两张图）
    - 凡是添加第二个以上的量到相同或不同Shelf中时，记得按住Ctrl再拖动，以免移除原来的量
    - 可以在【标记】中编辑多个总和GMV的表计算，数值标记的上下位置，颜色等
- 关系分布（位置分布）
  - 散点图（1：40：30）：【列】总和cpc总费用【行】总和GMV 【标记】（详细信息）日期（复制）， 即字符格式的日期 【分析】趋势线（越陡峭，投入产出比越高）；再添加 【标记】（颜色）门店名称， 可以观察投入产出比最高的门店
    - 聚类分析：【列】总和cpc总费用【行】总和GMV 【标记】（详细信息））门店名称 【分析】聚类 拖拽至 群集（创建群集）建立2、3以及更多个群集
  - 直方图（~1：43：10）：对想要划分数据段落的量 右键-创建-数据桶，设定数据桶总数。【列】用户实付数据桶【行】计数(orders.csv)【标签】计数(orders.csv)；或多选选中这些量，使用Show Me智能推荐-直方图，会自动创建数据桶与计数
    - 我有效的操作：1. 选 用户实付，从Show Me中点击直方图即可；2. 手动右击用户实付-创建create-数据桶 bins，这时在维度中会出现一个 用户实付（bin），将它右键-convert to continuous确保它是绿色的连续值，拖入【列】；将度量中原本的用户实付拖入【行】，右键它-Measure(Sum)-Count, 使得它成为计数
  - 地图（1：44：04）：双击城市（出现地图）；右键 配送坐标-纬度  -地理角色-纬度，类似地修改配送坐标-经度（1：44：46）并且使【列】经度，【行】纬度
    - 进而对这些经纬度用维度进行区分，比如：将订单id - 右键-字符串，再【标记】（详细信息）订单id。但由于订单id已经被脱敏处理，不能完全区分开所有订单。因此，右键把下单日期时间复制一份，改为字符串，再【标记】（详细信息)下单日期，用来区分不同下单日期的经纬度
    - 添加【标记】（大小）总和用户实付，来进一步区分经纬度数据点；（颜色）总和距离，类似地
    - 但是目前总和距离的颜色标记是有问题的：相同下单日期时间的数据点的总和距离被自动相加了（光标悬浮在数据点上-查看数据）。因此 左边-创建计算字段-命名为“主键”，内容设定为【下单日期时间（复制）】+【配送地址eleme】+【订单id】+【用户id】（也可以用str(用户id）代替）（而后可以右键主键-编辑，来修改内容），代替下单日期时间 即 【标记】（详细信息）主键，用于对每一个数据点进行唯一的识别。

### 6)Rules of Data Visualisation
- 区分用户-不同层级的主管关心不同的内容
- 真实准确、主次分明、详略得当
- 适度原则：3D扭曲大小，要避免；颜色不超过8种
- 五秒原则：五秒内没有看懂，则还需要优化
- 说明恰到好处：给仔细看的观众多一些说明，其他观众不必说明太多、多说多错

### 7)Build a BI Panel
仪表盘：要符合业务思考逻辑

#### 具体操作（2：03：43）
##### 图表内容
- 经营情况总览
  【列】度量名称【行】（空）【标记】（文本）度量值【度量值】总和GMV，总和商家实收，总和曝光人数，总和进店人数，总和下单人数，总和无效订单树，总和商户补贴，总和平台补贴，总和cpc总费用【筛选器】度量名称，日期（并且右键日期-应用于工作表-使用相关数据源的所有项，即所有工作表sheets，筛选到2019-10-28 ~ 2020-09-25
 
- 经营数据详情（2：05：47）
  在经营情况总览的表格里，加入【行】日期（复制）（也可以不加，改为把日期放入筛选器，应用于全部工作表使用相同数据源的数据），门店名称
  
- 每日营收数据（2：06：50）多轴折线图
  【列】日期（天）【行】度量值【标记】（颜色）度量名称【度量值】总和GMV， 总和商家实收，总和平台补贴【筛选器】日期，度量名称
  - 其中，也可以先拖拽总和GMV进入【行】，把添加的其他度量拖到作图区域的竖轴上，效果相同；但单位可能会不匹配（解决见下）
  - 可以右键shop.csv的日期（日期格式）-创建-自定义日期-详细信息：天，选中“日期值"，（而对离散的字符串 日期，选择”日期部分“）那么每次可以使用这个新建的 日期（天）
  - 创建计算字段-名称：进店率，内容: 输入SUM(，拖入进店人数，）/( 拖入曝光人数，即`SUM(进店人数)/SUM(曝光人数)`，而后对已经创建完毕的 进店率 右键-默认数字格式-百分比，小数位数：2位；类似地，创建成交率：SUM(下单人数)/SUM(进店人数)
  - 为了解决多轴折线图中多个量的单位不匹配：【列】日期（天}【行】总和曝光人数 | 度量值 （即右键前者-双轴）【标记】（颜色）度量名称【度量值】聚合（成交率），聚合（进店率）（双轴可以改回非双轴：右键右边的轴-同步轴）
  - 进一步将曝光人数从折线改为条形图，并右键大小，颜色进行调窄、调透明，在【行】中调换顺序以调换作图的图层顺序，使曝光人数成为两个百分比率折线的背景；最后全部折线图都加上趋势线

- 新老客占比（2：11：39）环形图
  创建计算字段-命名：新老客，内容：
  ```
  IF IFnull ([order_90d],0)=0 then '新客'
  ELSE '老客'
  END
  ```
  （即90天内没有下单的为新客）;\
  - 先做饼图：【标记】（颜色）新老客，（大小）计数（orders.csv)，（标签）计数（orders.csv）（右键-快速表计算-合计百分比)，（标签）新老客，（工具提示）总和订单金额（使得图标本身不标记这个度量，但光标悬浮时会显示）【筛选器】日期
  - 在从饼图改为环形图：【行】总和0 | 总和0 （双击，输入两个0 即添加横轴来复制，再通过变为双轴来合并两个饼图；注意双轴之后会自动出现【标记】（颜色）度量名称，这个可以移除），【标记】把下面那个图层的标记都删掉，颜色改为白色，大小变小
  - 最后把坐标轴清除掉：分别右键左右两个纵轴，不选中显示标题即可；右键作图区域-设置格式-（左侧 设置线格式）最后一项-零值线：无，来去除横轴的零值线

- 平台占比（2：15：52）环形图
  - 先复制粘贴新老客占比的环形图工作表，然后改为：【列】（空白）【行】总和0 | 总和0【标记】（颜色）平台，（大小）总和GMV，（标签）平台，（标签）总和GMV（右键-快速表计算-合计百分比)
  - 此时标签显示的是平台的拼音，可以通过设置 平台 的别名来解决：右键平台-编辑别名-eleme：饿了么，meituan：美团

- 门店占比（2：17：49）环形图
  - 复制粘贴平台占比的环形图工作表，然后用门店 替换 平台 即可

- 投放情况（2：18：19）散点图
  - 【列】cpc总费用【行】商家实收【标记】（详细信息） 日期（复制），（标签） 日期（复制），（颜色）品牌名称 【筛选器】日期
  - 分析-添加趋势线

- 订单分布（2：19：28）面积图


- 配送分布（2：20：58）地图

##### 仪表盘布局 （2：24：14）

- 右边筛选器显示区域，右键-选择相应的显示、隐藏、浮动或修改格式 （2：31：07）


##### 添加细节 
- 联动筛选（2：37：32）每一个工作表选中后，选上漏斗图标 即 联动筛选
- 边框（2：38：27）在左边 布局 中调整边框格式
- 简化（2：39：49）回到经营情况总览 的工作表，选中行分隔符（两条线）-右键-设置边界格式，再到左边 （工作表）-行分隔符-区：无，即移除行分隔符
- 地图改变底色（2：40：18）回到配送分布 的工作表，往上找到 地图（M）-背景地图-普通，再选中地图（M）-地图层-再到左边 调高“冲蚀”
- 填充(2:40:37) 如有必要可以增加新的空白区域 填充布局
- 字体（2：40：46）右键某一工作表-编辑标题，或设置格式（O）-仪表盘-工作表标题 来统一替换；对内容的字体，右键相应工作表内的文字内容0设置格式-再到左侧设置即可
- 配色：到各个工作表内【标记】（颜色）中选择想要的配色即可，另外对区域 可以使用分配调色盘（？）

